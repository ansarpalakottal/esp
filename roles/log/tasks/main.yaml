---
- name: checking "{{ dir }}" exists or not
  file:
    path: "{{ dir }}"
    state: directory

- name: Finding the older logs
  find:
    paths: "{{ dir }}"
    age: 90d
  register: list

- name: removing the 90 days older files
  file:
    path: "{{ item.path }}"
    state: absent
  with_items:
    - "{{ list.files }}"

- name: checking the log file exists or not
  stat:
    path: "{{ dir }}/esp_deploy_{{ dt }}_{{ tm }}.log"
  register: file_path

- name: creating the log file
  file:
    path: "{{ dir }}/esp_deploy_{{ dt }}_{{ tm }}.log"
    state: touch
    force: no
  when: file_path.stat.exists != true

- include: ./writing_log.yaml
